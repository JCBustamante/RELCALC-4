<section xml:id="intfactor_section">
  <title>Équations linéaires et facteur intégrant</title>
  <introduction>
    <p>
      Les <em>équations linéaires<idx><h>équation linéaire</h></idx>
      </em> sont parmi les équations différentielles les plus importantes à comprendre.
      Une bonne partie des équations que nous voyons dans ce manuel sont en fait linéaires.
      Cette section est dédiée aux
      <em>équations linéaires du premier ordre<idx><h>équations linéaires du premier ordre</h></idx>
      </em>.
      Une équation du premier ordre est dite linéaire si elle peut s'écrire sous la forme suivante :
      <men xml:id="lineq_eq1">
        y' + p(x) y = f(x)
      </men>.
    </p>
    <p>
      Être linéaire veut dire que l'expression est linéaire en <m>y</m> et <m>y'</m>;
      l'équation ne contient pas de puissances plus élevées ni d'autres fonctions de <m>y</m> ou <m>y'</m>.
      Cependant, la dépendance sur la variable <m>x</m> peut être plus compliquée.
    </p>
    <p>
      La raison pour laquelle on aime les équations linéaires,
      c'est qu'elles ont de belles propriétés.
      Par exemple,
      la solution existe pour tout <m>x</m> où <m>p(x)</m> et <m>f(x)</m> sont définies
      (voir de plus la <xref ref="rem_regular">remarque</xref>).
      Ce qui nous intéressera surtout, à
      ce stade-ci,
      c'est qu'il y a une méthode générale pour résoudre les équations linéaires du premier ordre.
    </p>
    <p>
      L'idée : réécrire le côté
      gauche de <xref ref="lineq_eq1"/> comme une dérivée du produit de <m>y</m> avec une fonction à déterminer.
      Ainsi, nous cherchons une fonction <m>r(x)</m> telle que :
      <me>
        r(x) y' + r(x) p(x) y = \frac{d}{dx}\Bigl[ r(x) y \Bigr]
      </me>.
    </p>
    <p>
      Ceci est le côté gauche de <xref ref="lineq_eq1"/> multiplié par <m>r(x)</m>.
      Donc, si l'on multiplie <xref ref="lineq_eq1"/> par <m>r(x)</m>,
      on obtient :
      <me>
        \frac{d}{dx}\Bigl[ r(x) y \Bigr] = r(x)f(x)
      </me>.
    </p>
    <p>
      Maintenant, on intègre les deux côtés.
      C'est possible puisque le côté
      droit ne dépend pas de <m>y</m> et que le côté
      gauche est la dérivée d'une fonction.
      Ensuite, on résout pour <m>y</m>.
      La fonction <m>r(x)</m> s'appelle le
      <em>facteur intégrant
          <idx><h>facteur intégrant</h></idx>
      </em>, et la méthode s'appelle la
      <em>méthode du facteur intégrant<idx><h>méthode du facteur intégrant</h></idx>
      </em>.
    </p>
    <p>
      Comment trouver <m>r(x)</m>?
      On cherche une fonction qui, lorsqu'on la dérive,
      donne de nouveau la fonction,
      multipliée par <m>p(x)</m>.
      Les fonctions exponentielles ont précisément cette propriété. On pose donc :
      <me>
        r(x) = e^{\int p(x) \,dx}
      </me>.
    </p>
    <p>
      On substitue cette valeur dans l'équation différentielle pour obtenir ce qui suit :
      <md>
        <mrow>y' + p(x) y  \amp = f(x) ,</mrow>
        <mrow>e^{\int p(x) \,dx} y' + e^{\int p(x) \,dx} p(x) y    \amp  = e^{\int p(x) \,dx} f(x) ,</mrow>
        <mrow>\frac{d}{dx}\left[ e^{\int p(x) \,dx} y \right]      \amp  = e^{\int p(x) \,dx} f(x) ,</mrow>
        <mrow>e^{\int p(x) \,dx} y \amp  = \int e^{\int p(x) \,dx} f(x) \,dx + C ,</mrow>
        <mrow>y    \amp  = e^{-\int p(x) \,dx} \left( \int e^{\int p(x) \,dx} f(x) \,dx + C \right) </mrow>
      </md>.
    </p>
    <p>
      On pourra obtenir une formule analytique pour <m>y</m>, à
      condition de pouvoir trouver les primitives de chacune des intégrales apparaissant dans l'expression.
    </p>
    <example>
      <statement>
        <p>
          Résolvons
          <me>
            y' + 2xy = e^{x-x^2}, \qquad y(0) = -1
          </me>.
        </p>
        <p>
          Notons d'abord que <m>p(x) = 2x</m> et que <m>f(x) = e^{x-x^2}</m>.
          Le facteur intégrant est <m>r(x) = e^{\int p(x)\, dx} = e^{x^2}</m>.
          On multiplie chaque côté
          de l'équation par <m>r(x)</m> pour obtenir :
          <md>
            <mrow>e^{x^2} y' + 2xe^{x^2}y \amp  = e^{x-x^2} e^{x^2} ,</mrow>
            <mrow>\frac{d}{dx} \left[ e^{x^2} y \right] \amp = e^x </mrow>
          </md>.
        </p>
        <p>
          On intègre :
          <md>
            <mrow>e^{x^2} y \amp = e^x +C ,</mrow>
            <mrow>y \amp = e^{x-x^2} + C e^{-x^2} </mrow>
          </md>.
        </p>
        <p>
          Ensuite, on résout pour la condition initiale
          <m>-1 = y(0) = 1 + C</m>, ce qui donne <m>C=-2</m>.
          La solution est donc :
          <me>
            y = e^{x-x^2} - 2 e^{-x^2}
          </me>.
        </p>
      </statement>
    </example>
    <p>
      Notons que nous pouvons prendre la primitive de notre choix pour <m>e^{\int p(x) dx}</m>.
      On peut ajouter une constante d'intégration,
      mais ça ne changera pas la réponse à la fin.
    </p>
    <exercise>
      <statement>
        <p>
          Essayez-le : ajoutez une constante d'intégration au facteur intégrant dans l'exemple et vérifiez que vous obtenez la même solution qu'ici.
        </p>
      </statement>
    </exercise>
    <p>
      Conseil : plutôt que d'apprendre par cœur la formule,
      retenez plutôt la méthode pour l'obtenir.
      C'est plus simple,
      et il suffit alors de répéter la méthode pour résoudre le problème.
    </p>
    <p>
      Puisqu'on ne peut pas toujours trouver une solution analytique,
      il peut être utile de savoir comment écrire la solution sous forme d'intégrale définie,
      car une intégrale définie peut être traitée par un logiciel de calcul.
      Soit l'équation suivante :
      <me>
        y' + p(x) y = f(x) , \qquad y(x_0) = y_0
      </me>.
    </p>
    <p>
      Écrivons la solution sous forme d'intégrale définie :
      <men xml:id="lei_defsol">
        \mybxbg{ ~~ y(x) = e^{-\int_{x_0}^x p(s)\, ds} \left( \int_{x_0}^x e^{\int_{x_0}^t p(s)\, ds} f(t) \,dt + y_0 \right). ~~ }
      </men>
    </p>
    <p>
      Cette formule peut maintenant être lue par une application de calcul numérique,
      si nous la codons convenablement.
    </p>
    <exercise>
      <statement>
        <p>
          Vérifiez que <m>y(x_0) = y_0</m> dans <xref ref="lei_defsol"/>.
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Écrivez la solution du problème suivant sous forme d'intégrale définie.
          Vous ne pourrez pas trouver une solution analytique à cette équation.
          <me>
            y' + y = e^{x^2-x}, \qquad y(0) = 10
          </me>.
        </p>
      </statement>
    </exercise>
    <remark xml:id="rem_regular">
      <p>
        Avant de continuer,
        notons quelques propriétés intéressantes des équations linéaires.
        Premièrement,
        il existe toujours une formule explicite <xref ref="lei_defsol"/> pour la solution de l'équation à
        condition initiale <m>y' + p(x) y = f(x)</m>, <m>y(x_0) = y_0</m>.
        Deuxièmement,
        la formule <xref ref="lei_defsol"/> implique que si <m>p(x)</m> et <m>f(x)</m> sont continues sur un intervalle <m>(a , b)</m>,
        alors la solution <m>y(x)</m> existe et est différentiable sur <m>(a , b)</m>.
        Comparez à l'exemple non linéaire vu précédemment,
        <m>y'=y^2</m>, ainsi qu'au <xref ref="slope_picardthm">théorème</xref>.
      </p>
    </remark>
    <example>
      <statement>
        <p>
          Voyons maintenant une application des équations linéaires qui est couramment rencontrée :
          la concentration de produits chimiques dans un plan d'eau.
        </p>
        <p>
          <image width="73%" source="lin-tank"/> 
          <!-- TODO on ne voit pas le texte sur l'image -->
          Un réservoir d'une capacité
          de 100 litres contient 10 kilogrammes de sel dissous dans 60 litres d'eau.
          Une solution d'eau saline avec une concentration de 0,1 kilogramme par litre entre dans le réservoir à
          un taux de 5 litres par minute.
          La solution dans le réservoir est bien brassée (c'est-à-dire qu'on peut supposer que la concentration est la même partout) et sort à
          un taux de 3 litres par minute.
          Combien de sel est contenu dans le réservoir lorsqu'il est plein?
        </p>
        <p>
          Commençons par établir l'équation différentielle modélisant ce problème.
          Dénotons par <m>x</m> la quantité
          de sel dans le réservoir,
          en kilogrammes, et par <m>t</m> le temps en minutes.
          Si l'on considère une petite variation <m>\Delta t</m> dans le temps,
          la variation en <m>x</m> (dénotée
          <m>\Delta x</m>) est approximativement :
          <me>
            \Delta x \approx (\text{ taux entrée }  \times \text{ concentration entrée } ) \Delta t - (\text{ taux sortie }  \times \text{ concentration sortie } ) \Delta t
          </me>.
        </p>
        <p>
          On divise partout par <m>\Delta t</m> et l'on prend la limite <m>\Delta t \to 0</m> pour obtenir :
          <me>
            \frac{dx}{dt} = (\text{ taux entrée }  \times \text{ concentration entrée } )  - (\text{ taux sortie }  \times \text{ concentration sortie } )
          </me>.
        </p>
        <p>
          Dans notre exemple :
          <md>
            <mrow>\text{ taux entrée }  \amp = 5 ,</mrow>
            <mrow>\text{ concentration entrée }  \amp = 0{,}1 ,</mrow>
            <mrow>\text{ taux sortie }  \amp = 3 ,</mrow>
            <mrow>\text{ concentration sortie }  \amp = \frac{x}{\text{ volume } } = \frac{x}{60+(5-3)t} </mrow>
          </md>.
        </p>
        <p>
          L'équation modélisant le problème est donc :
          <me>
            \frac{dx}{dt} =  (5 \times 0,1)  -   \left(3 \frac{x}{60+2t}\right)
          </me>.
        </p>
        <p>
          On réécrit ceci sous la forme <xref ref="lineq_eq1"/> :
          <me>
            \frac{dx}{dt} +   \frac{3}{60+2t} x =   0,5
          </me>.
        </p>
        <p>
          Maintenant, on peut résoudre l'équation.
          Le facteur intégrant est :
          <me>
            r(t) = \exp \left( \int \frac{3}{60+2t} dt  \right) =   \exp \left( \frac{3}{2} \ln (60+2t) \right) =   {(60+2t)}^{3/2}
          </me>.
        </p>
        <p>
          On multiplie les deux côtés de l'équation par le facteur intégrant et l'on obtient :
          <md>
            <mrow>{(60+2t)}^{3/2} \frac{dx}{dt} + {(60+2t)}^{3/2} \frac{3}{60+2t} x \amp  =   0,5{(60+2t)}^{3/2},</mrow>
            <mrow>\frac{d}{dt}\left[{(60+2t)}^{3/2} x \right] \amp  = 0,5{(60+2t)}^{3/2},</mrow>
            <mrow>{(60+2t)}^{3/2} x \amp  = \int  0,5{(60+2t)}^{3/2} dt +C,</mrow>
            <mrow>x  \amp  =   {(60+2t)}^{-3/2} \int  \frac{{(60+2t)}^{3/2}}{2}dt +C{(60+2t)}^{-3/2},</mrow>
            <mrow>x  \amp  =  {(60+2t)}^{-3/2}\frac{1}{10}{(60+2t)}^{5/2}  +C{(60+2t)}^{-3/2},</mrow>
            <mrow>x  \amp  = \frac{60+2t}{10}+C{(60+2t)}^{-3/2} </mrow>
          </md>.
        </p>
        <figure xml:id="linear-salt-graph_fig">
          <caption>Graphe de la solution <m>x</m> kilogrammes de sel dans le réservoir au temps <m>t</m>.</caption>
          <!-- {3.25in} -->
          <!-- \diffyincludegraphics{width=3in}{width=4.5in}{linear-salt-graph} -->
          <image width="100%" source="linear-salt-graph"/>
        </figure>
        <p>
          On doit trouver la valeur de <m>C</m>.
          On sait qu'à <m>t=0</m>, <m>x=10</m>.
          Donc,
          <me>
            10 = x(0)   =   \frac{60}{10}+C{(60)}^{-3/2} =6 +C{(60)}^{-3/2}
          </me>
          ou
          <me>
            C=4 ({60}^{3/2}) \approx 1859{,}03
          </me>.
        </p>
        <p>
          On cherche à savoir la valeur de <m>x</m> lorsque le réservoir est plein.
          Ceci arrive lorsque <m>60+2t = 100</m>,
          c'est-à-dire à <m>t=20</m>.
          Donc :
          <me>
            x(20) = \frac{60+40}{10}+C{(60+40)}^{-3/2} \approx  10 +1859,03 {(100)}^{-3/2} \approx 11{,}86 .
          </me>
        </p>
        <p>
          Voir la <xref ref="linear-salt-graph_fig"></xref>
          pour le graphe de <m>x</m> en fonction de <m>t</m>.
        </p>
        <p>
          La concentration dans le réservoir plein est approximativement
          <!-- \unitfrac[0{,}1186]{kg}{litre} -->
          0,1186 kg/L,
          alors que la concentration initiale est de
          <m>\nicefrac{1}{6}</m> ou 
          <!-- \unitfrac[0{,}167]{kg}{litre} -->
          0,167 kg/L.
        </p>
      </statement>
    </example>
  </introduction>
  <subsection>
    <title>Exercices</title>
    <p>
      Dans les exercices suivants, n'hésitez pas à
      laisser la réponse sous forme d'intégrale définie si une solution analytique n'est pas possible.
      Mais si la solution analytique existe, c'est celle-là
      que vous devriez donner.
    </p>
    <exercise>
      <statement>
        <p>
          Résolvez <m>y' + xy = x</m>.
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Résolvez <m>y' + 6y = e^x</m>.
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Résolvez <m>y' + 3x^2y = \sin(x) \, e^{-x^3}</m>,
          <m>y(0) = 1</m>.
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Résolvez <m>y' + \cos (x) y = \cos(x)</m>.
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Résolvez <m>\frac{1}{x^2+1} \, y' + x y = 3</m>, <m>y(0) = 0</m>.
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Supposons que deux lacs se trouvent sur le plan d'un ruisseau.
          De l'eau propre s'écoule dans le premier lac,
          ensuite l'eau s'écoule du premier lac au deuxième lac,
          et enfin l'eau se déverse en aval du ruisseau à
          partir du deuxième lac.
          Le débit à l'entrée et à
          la sortie de chaque lac est 500 litres par heure.
          Le premier lac contient 100 000 litres d'eau et le deuxième lac en contient 200 000.
          Un camion déverse \unit[500]{kg} d'une matière dangereuse.
          On suppose que l'eau est bien brassée par le ruisseau. \begin{tasks} \task Trouvez la concentration de la matière dangereuse dans chacun des lacs,
          en fonction du temps. \task À quel moment est-ce que la concentration dans le premier lac tombe en-dessous de \unit[0.001]{kg} par litre? \task À quel moment est-ce que la concentration dans le deuxième sera maximale? \end{tasks}
        </p>
        <!-- TODO begin tasks -->
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          La loi de refroidissement de Newton<idx><h>loi de refroidissement de Newton</h></idx> affirme que <m>\frac{dx}{dt} = -k(x-A)</m>,
          où <m>x</m> est la température, <m>t</m> est le temps,
          <m>A</m> est la température ambiante,
          et <m>k > 0</m> est une constante.
          Supposons que <m>A = A_0 \cos (\omega t)</m>,
          où <m>A_0</m> et <m>\omega</m> sont des constantes.
          Autrement dit,
          la température ambiante oscille en fonction du temps
          (par exemple,
          varie entre le jour et la nuit). \begin{tasks} \task Trouvez la solution générale. \task Est-ce que les conditions initiales ont un impact sur le comportement à
          long terme de la solution?
          Pourquoi ou pourquoi pas? \end{tasks}
        </p>
        <!-- TODO begin tasks -->
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Un réservoir contient 5 grammes de sel dissous dans 20 litres d'eau.
          Une solution saline,
          dont la concentration est de 2 grammes par litre, s'y déverse à
          un taux de 3 litres par minute.
          Le contenu du réservoir est bien brassé et en ressort à
          un taux de 3 litres par minute.
          Quelle doit être la durée du procédé
          pour obtenir 20 grammes de sel dans le réservoir?
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Un réservoir contient 10 litres d'eau propre.
          Une solution saline, de concentration inconnue mais constante,
          se déverse dans le réservoir à
          un taux de 1 litre par minute.
          Le contenu du réservoir est bien brassé et en ressort à
          un taux de 1 litre par minute.
          Au bout de 20 minutes, le réservoir contient 15 grammes de sel.
          Quelle est la concentration de la solution saline entrante?
        </p>
      </statement>
    </exercise>
    <exercise>
      <statement>
        <p>
          Résolvez <m>y'+3 x^2 y = x^2</m>.
        </p>
      </statement>
    </exercise>
    <answer>
      <p>
        <m>y = C e^{-x^3} + \nicefrac{1}{3}</m>
      </p>
    </answer>
    <exercise>
      <statement>
        <p>
          Résolvez <m>y'+ 2\sin(2x) y = 2\sin(2x)</m>,
          <m>y(\nicefrac{\pi}{2}) = 3</m>.
        </p>
      </statement>
    </exercise>
    <answer>
      <p>
        <m>y = 2 e^{\cos(2x)+1} + 1</m>
      </p>
    </answer>
    <exercise>
      <statement>
        <p>
          Un réservoir d'eau est vidé à
          un taux de
          <!-- \unitfrac[3]L{min} -->
          3 L/min. Au départ,
          le réservoir contient 10 L
          <!-- \unit[10]L -->
          d'eau propre.
          De l'eau contenant une matière dangereuse se déverse dans le réservoir à
          un taux de 2 L/min
          <!-- \unitfrac[2]L{min} -->
          , ave une concentration de
          <m>20t</m> g/L
          <!-- \unitfrac[<m>20t</m>]{g}L  -->
          au temps <m>t</m>.
          Au moment où le réservoir est à moitié
          vide, combien de grammes de matière dangereuse sont contenus dans le réservoir? (On suppose que c'est bien brassé.)
        </p>
      </statement>
    </exercise>
    <answer>
      <p>
        <m>250</m> grammes
      </p>
    </answer>
    <exercise>
      <statement>
        <p>
          Supposons qu'on ait une population de bactéries à
          laquelle on ajoute graduellement une substance toxique,
          de telle sorte que le taux de croissance diminue.
          Plus précisément, <m>\frac{dP}{dt} = (2-0{,}1\,t)P</m>.
          Si <m>P(0) = 1000</m>, trouvez la population pour <m>t=5</m>.
        </p>
      </statement>
    </exercise>
    <answer>
      <p>
        <m>P(5) = 1000 e^{2 \times 5 - 0{,}05 \times {5}^2} = 1000 e^{8{,}75} \approx 6{,}31 \times {10}^6</m>
      </p>
    </answer>
    <exercise>
      <statement>
        <p>
          De l'eau se déverse dans un réservoir cylindrique à
          un débit de <m>d</m> mètres cube par seconde.
          Soit <m>A</m> l'aire d'une section transversale du réservoir,
          en mètres.
          Supposons que l'eau sort du réservoir à
          un débit qui est proportionnel à
          la hauteur du niveau d'eau.
          Trouvez l'équation différentielle décrivant <m>h</m>,
          la hauteur du niveau d'eau,
          en introduisant les constantes dont vous avez besoin.
          Donnez aussi les unités pour vos constantes.
        </p>
      </statement>
    </exercise>
    <answer>
      <p>
        <m>Ah' = d - kh</m>,
      où <m>k</m> est une constante mesurée en <m>m^2 s</m>
      . 
     
      </p>
    </answer>
  </subsection>
</section>